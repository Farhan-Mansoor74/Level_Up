<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Vue.js After School Clubs</title>
		<script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
		<script src="clubs.js"></script>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
		/>
		<link rel="stylesheet" href="css/styles.css" />
	</head>

	<body>
		<div id="app">
			<!-- Navbar -->
			<header class="topnav">
				<!-- Logo -->
				<a href="#">
					<img
						src="images/LevelUplogo.png"
						id="logo"
						alt="Logo"
						@click="toLandingPage"
					/>
				</a>

				<!-- Search Container -->
				<div class="search-container">
					<form @submit.prevent="searchClubs">
						<input
							type="text"
							v-model="searchQuery"
							placeholder="Search clubs..."
							name="search"
							style="padding: 10px 20px"
							@input="searchClubs"
						/>
						<button type="submit" id="searchButton">
							<i class="fas fa-search"></i>
						</button>
					</form>
				</div>

				<!-- Cart Button -->
				<button @click="showCheckout" class="cart-button">
					<span class="fas fa-cart-plus"></span>
					<sup>{{ cartItemCount }}</sup>
				</button>
			</header>

			<!-- Custom Alert -->
			<div v-if="showAlert" class="alert-user">
				<span class="alert-icon"
					><i class="fas fa-check-circle"></i
				></span>
				{{ alertMessage }}
			</div>

			<!-- Landing Page Section -->
			<main class="landing" v-if="!showClubs && !checkoutPage">
				<div class="landing-section">
					<div class="text-content">
						<h2>Welcome to {{ sitename }}</h2>
						<p>
							Explore a variety of after-school clubs that suit
							your interests and help you grow. From sports to
							academics, we have it all!
						</p>
						<button class="view-courses-btn" @click="viewCourses">
							View All Courses
						</button>
					</div>

					<!-- Background Video Section -->
					<div class="video-wrapper">
						<video autoplay muted loop class="background-video">
							<source src="images/bg_vid.mp4" type="video/mp4" />
							Your browser does not support the video tag.
						</video>
					</div>
				</div>

				<div class="slideshow-container">
					<div class="mySlides fade">
						<div class="numbertext">1 / 3</div>
						<img src="images/football.jpg" style="width: 100%" />
						<div class="text">Football</div>
					</div>

					<div class="mySlides fade">
						<div class="numbertext">2 / 3</div>
						<img src="images/debate.jpg" style="width: 100%" />
						<div class="text">Debate</div>
					</div>

					<div class="mySlides fade">
						<div class="numbertext">3 / 3</div>
						<img src="images/cricket.jpeg" style="width: 100%" />
						<div class="text">Cricket</div>
					</div>
				</div>

				<br />

				<div style="text-align: center">
					<span class="dot"></span>
					<span class="dot"></span>
					<span class="dot"></span>
				</div>
			</main>

			<!-- Display Clubs -->
			<main v-if="showClubs && !checkoutPage">
				<div class="sort-section">
					<label for="sort">Sort by:</label>
					<select v-model="sortOption" @change="sortClubs">
						<option value="subject">Subject</option>
						<option value="location">Location</option>
						<option value="fee">Price</option>
						<option value="spaces">Availability</option>
					</select>
					<label for="order">Order:</label>
					<select v-model="sortOrder" @change="sortClubs">
						<option value="asc">Ascending</option>
						<option value="desc">Descending</option>
					</select>
				</div>

				<div class="all-clubs">
					<div
						v-for="club in searchResults"
						:key="club.id"
						class="club-card"
					>
						<span class="availability-tag"
							>{{ club.availableInventory }} available</span
						>

						<img :src="club.image" alt="Club Image" />
						<div class="product-title-wrap">
							<h2 v-text="club.subject"></h2>
							<p style="font-weight: bold">
								{{ club.fee }} AED per/hr
							</p>
						</div>
						<h6 class="location">Location: {{ club.location }}</h6>

						<div>
							<span v-for="n in club.rating"> ★ </span>
							<span v-for="n in 5 - club.rating"> ☆ </span>
						</div>
						<button
							@click="addToCart(club)"
							:disabled="club.availableInventory <= 0 || cart.includes(club.id)"
							class="addClub"
						>
							Add to Cart
						</button>
					</div>
				</div>
			</main>

			<!-- Checkout Page -->
			<main v-if="checkoutPage">
				<div class="checkout-container">
					<!-- Left Side: Customer Information -->
					<div class="checkout-left">
						<h2>Checkout</h2>
						<p>
							<strong>Name:</strong>
							<input
								v-model.trim="order.name"
								placeholder="Full Name"
							/>
						</p>
						<p>
							<strong>Email:</strong>
							<input
								v-model="order.email"
								type="email"
								placeholder="Email Address"
							/>
						</p>
						<p>
							<strong>Phone:</strong>
							<input
								v-model="order.phone"
								type="tel"
								placeholder="Phone Number"
							/>
						</p>
					</div>
					<!-- Right Side: Cart Details -->
					<div class="checkout-right">
						<h2>Your Cart ({{ cartItemCount }} items)</h2>
						<div
							v-for="club in cartDetails"
							:key="club.id"
							class="checkout-club"
						>
							<img
								:src="club.image"
								alt="Club Image"
								class="cart-image"
							/>
							<div class="club-info">
								<span class="club-name"
									>{{ club.subject }}</span
								>
								<span class="club-price"
									>{{ club.fee }} AED per hour</span
								>
							</div>
							<button
								@click="removeFromCart(club)"
								class="remove-btn"
							>
								Remove
							</button>
						</div>
						<div class="cart-total">
							<p>
								Total:
								<span class="price" style="color: black"
									><b>{{ cartTotal }} AED</b></span
								>
							</p>
						</div>

						<!-- Place Order Button -->
						<button
							class="place-order-btn"
							v-if="isOrderValid"
							@click="submitForm"
						>
							Place Order
						</button>
					</div>
				</div>

				<!-- Back to Courses Button -->
				<button
					class="back-btn"
					@click="viewCourses"
					style="margin-left: 2rem"
				>
					Back to Courses
				</button>
			</main>
		</div>

		<script type="text/javascript">
			let webstore = new Vue({
				el: "#app",
				data: {
					sitename: "Level Up",
					clubs: clubs,
					showClubs: false,
					checkoutPage: false,
					cart: [],
					searchQuery: "",
					sortOption: "subject", // Default sorting option
					sortOrder: "asc", // Default sort order
					alertMessage: "",
					showAlert: false,
					alertTimeout: null,
					order: {
						name: "",
						email: "",
						phone: "",
					},
					slideIndex: 0,
					searchResults: [], // Array to store search results
				},
				mounted() {
					this.$nextTick(() => {
						this.showSlides();
						this.searchResults = this.clubs; // Populate searchResults with all clubs initially
					});
				},
				computed: {
					cartItemCount: function () {
						return this.cart.length;
					},
					cartDetails: function () {
						return this.cart.map((id) =>
							this.clubs.find((club) => club.id === id)
						);
					},
					cartTotal() {
						return this.cartDetails.reduce(
							(total, club) => total + club.fee,
							0
						);
					},
					isOrderValid() {
						return (
							this.order.name &&
							this.order.email &&
							this.order.phone
						);
					},
				},
				methods: {
					addToCart: function (club) {
						if (
							club.availableInventory > 0 &&
							!this.cart.includes(club.id)
						) {
							this.cart.push(club.id);
							club.availableInventory--;
							this.alertUser(
								`${club.subject} has been added to the cart!`
							);
						} else {
							this.alertUser(
								`${club.subject} is already in the cart or out of stock!`
							);
						}
					},
					alertUser: function (message) {
						this.alertMessage = message;
						this.showAlert = true;
						clearTimeout(this.alertTimeout);
						this.alertTimeout = setTimeout(() => {
							this.showAlert = false;
						}, 3000);
					},
					removeFromCart: function (club) {
						let index = this.cart.indexOf(club.id);
						if (index !== -1) {
							this.cart.splice(index, 1);
							club.availableInventory++;
						}
					},
					showCheckout: function () {
						if (this.cart.length == 0) {
							alert(
								"Cart is empty! Please select a course to proceed."
							);
						} else {
							this.showClubs = false;
							this.checkoutPage = true;
						}
					},
					viewCourses: function () {
						this.showClubs = true;
						this.checkoutPage = false;
					},
					toLandingPage: function () {
						this.showClubs = false;
						this.checkoutPage = false;
					},
					sortClubs: function () {
						this.clubs.sort((a, b) => {
							let comparison = 0;
							if (this.sortOption === "subject") {
								comparison = a.subject.localeCompare(b.subject);
							} else if (this.sortOption === "location") {
								comparison = a.location.localeCompare(
									b.location
								);
							} else if (this.sortOption === "fee") {
								comparison = a.fee - b.fee;
							} else if (this.sortOption === "spaces") {
								comparison =
									a.availableInventory - b.availableInventory;
							}
							return this.sortOrder === "asc"
								? comparison
								: -comparison;
						});
					},
					submitForm: function () {
						alert("Order Submitted");
						this.cart = [];
						this.checkoutPage = false;
						this.showClubs = false;
					},
					searchClubs: function () {
						const query = this.searchQuery.toLowerCase();
						if (query === "") {
							this.searchResults = this.clubs; // If search query is empty, show all clubs
						} else {
							this.searchResults = [];
							for (let club of this.clubs) {
								if (
									this.isSubstring(
										query,
										club.subject.toLowerCase()
									)
								) {
									this.searchResults.push(club);
								}
							}
						}
					},
					isSubstring: function (query, subject) {
						for (
							let i = 0;
							i <= subject.length - query.length;
							i++
						) {
							let found = true;
							for (let j = 0; j < query.length; j++) {
								if (subject[i + j] !== query[j]) {
									found = false;
									break;
								}
							}
							if (found) {
								return true;
							}
						}
						return false;
					},
					showSlides: function () {
						let slides =
							document.getElementsByClassName("mySlides");
						let dots = document.getElementsByClassName("dot");

						if (slides.length === 0 || dots.length === 0) {
							// If elements are not yet rendered, try again after a short delay
							setTimeout(this.showSlides, 100);
							return;
						}

						for (let i = 0; i < slides.length; i++) {
							slides[i].style.display = "none";
						}
						this.slideIndex++;
						if (this.slideIndex > slides.length) {
							this.slideIndex = 1;
						}
						for (let i = 0; i < dots.length; i++) {
							dots[i].className = dots[i].className.replace(
								" active",
								""
							);
						}
						slides[this.slideIndex - 1].style.display = "block";
						dots[this.slideIndex - 1].className += " active";
						setTimeout(this.showSlides, 3000); // Change image every 3 seconds
					},
				},
			});
		</script>
	</body>
</html>
